<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>five-a-side | Premier League Quiz</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      .fade-in {
        animation: fadeIn 0.5s;
      }
      .fade-out {
        animation: fadeOut 0.5s;
      }
      .slide-in {
        animation: slideIn 0.5s;
      }
      @keyframes fadeIn {
        from {
          opacity: 0;
        }
        to {
          opacity: 1;
        }
      }
      @keyframes fadeOut {
        from {
          opacity: 1;
        }
        to {
          opacity: 0;
        }
      }
      @keyframes slideIn {
        from {
          transform: translateY(-20px);
          opacity: 0;
        }
        to {
          transform: translateY(0);
          opacity: 1;
        }
      }
      .pulse {
        animation: pulse 1s infinite;
      }
      @keyframes pulse {
        0% {
          opacity: 1;
        }
        50% {
          opacity: 0.5;
        }
        100% {
          opacity: 1;
        }
      }
      .blur-background {
        filter: blur(4px);
      }
      .carousel-container {
        position: relative;
        width: 100%;
        max-width: 400px;
        margin: auto;
        overflow: hidden;
      }
      .carousel-item {
        display: none;
        text-align: center;
      }
      .carousel-item.active {
        display: block;
      }
      .carousel-btn {
        background-color: #fbbf24; /* Tailwind yellow-500 */
        color: #000;
        font-weight: bold;
        padding: 10px 20px;
        border: none;
        border-radius: 5px;
        cursor: pointer;
        margin: 10px;
      }
      .carousel-btn:hover {
        background-color: #f59e0b; /* Tailwind yellow-400 */
      }
      .carousel-btn-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-top: 20px;
      }
    </style>
  </head>
  <body
    class="bg-gray-900 min-h-screen flex items-center justify-center p-2 font-poppins text-gray-100 text-base sm:text-lg touch-manipulation"
  >
    <div
      id="game-container"
      class="bg-gray-800 rounded-2xl shadow-xl p-4 w-full max-w-xl sm:max-w-2xl md:max-w-3xl lg:max-w-4xl space-y-4"
    >
      <h1 class="text-3xl sm:text-4xl font-bold text-center text-white">
        five-a-side
      </h1>
      <div
        id="round-info"
        class="text-gray-200 text-lg sm:text-xl font-semibold text-center mt-2 mb-4"
      ></div>
      <div id="letter-grid" class="mb-4">
        <!-- Letter grid will be dynamically populated here -->
      </div>
      <div
        id="starting-lineup"
        class="text-center text-lg sm:text-xl font-semibold mb-4 hidden"
      >
        Your starting lineup:
      </div>
      <div id="game-info-section" class="hidden">
        <div
          id="timer-container"
          class="w-full bg-gray-700 rounded-full h-2 sm:h-3 mb-2 sm:mb-4"
        >
          <div
            id="timer-bar"
            class="bg-red-700 h-2 sm:h-3 rounded-full transition-all duration-1000 ease-linear"
            style="width: 100%"
          ></div>
        </div>
        <div id="game-info" class="grid grid-cols-2 sm:grid-cols-4 gap-2 mb-4">
          <div
            id="timer"
            class="bg-red-700 rounded-lg p-2 text-center font-bold text-sm sm:text-base text-white"
          >
            Time: 45s
          </div>
          <div
            id="score"
            class="bg-blue-700 rounded-lg p-2 text-center font-bold text-sm sm:text-base text-white"
          >
            Score: 0
          </div>
          <div
            id="substitutions"
            class="bg-yellow-500 rounded-lg p-2 text-center font-bold text-sm sm:text-base text-gray-900"
          >
            Subs: 5
          </div>
          <div
            id="guesses-left"
            class="bg-green-700 rounded-lg p-2 text-center font-bold text-sm sm:text-base text-white"
          >
            Guesses: 3
          </div>
        </div>
      </div>
      <div
        id="player-card"
        class="bg-gray-700 rounded-lg p-4 mb-4 shadow-inner hidden"
      >
        <div
          id="player-name"
          class="text-2xl sm:text-3xl font-bold text-center tracking-wider h-10 sm:h-12 font-mono"
        ></div>
      </div>
      <div
        id="current-team"
        class="text-center text-sm sm:text-base font-semibold mb-2 hidden"
      >
        Your current team:
      </div>
      <div id="game-controls" class="hidden justify-center space-x-2 mb-4">
        <button
          id="solve"
          class="bg-green-700 hover:bg-green-800 font-bold py-3 px-4 rounded-lg transition duration-300 text-sm sm:text-base flex-1 text-white"
        >
          Guess
        </button>
        <button
          id="substitute"
          class="bg-yellow-500 hover:bg-yellow-600 font-bold py-3 px-4 rounded-lg transition duration-300 text-sm sm:text-base flex-1 text-gray-900"
        >
          Substitutions
        </button>
        <button
          id="varButton"
          class="bg-purple-600 hover:bg-purple-700 font-bold py-3 px-4 rounded-lg transition duration-300 text-sm sm:text-base flex-1 text-white"
        >
          VAR
        </button>
      </div>
      <button
        id="start-game"
        class="hidden w-full bg-red-700 hover:bg-red-800 font-bold py-3 px-4 rounded-lg transition duration-300 text-lg sm:text-xl text-white"
      >
        Start Game
      </button>
      <button
        id="new-game"
        class="hidden w-full bg-red-700 hover:bg-red-800 font-bold py-3 px-4 rounded-lg transition duration-300 text-lg sm:text-xl text-white"
      >
        New Game
      </button>
      <button
        id="how-to-play-btn"
        class="absolute top-2 right-2 bg-gray-800 hover:bg-gray-900 font-bold py-2 px-3 rounded-lg transition duration-300 text-sm text-white"
      >
        How to Play
      </button>
    </div>

    <!-- Modals -->
    <div
      id="substituteModal"
      class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center"
    >
      <div class="bg-gray-800 rounded-lg p-4 max-w-md w-full">
        <h2 class="text-xl font-bold text-center mb-3">Make a change</h2>
        <div id="substitute-grid" class="mb-3"></div>
      </div>
    </div>

    <div
      id="solveModal"
      class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center"
    >
      <div class="bg-gray-800 rounded-lg p-4 max-w-sm w-full">
        <h2 class="text-xl font-bold text-center mb-3">
          Guess the player name
        </h2>
        <div
          id="solve-timer"
          class="text-lg font-semibold text-center text-yellow-400 mb-3"
        ></div>
        <input
          type="text"
          id="solve-input"
          placeholder="Enter player name"
          class="w-full p-2 bg-gray-700 border border-gray-600 rounded-lg mb-3 text-white"
        />
        <button
          id="submit-solve"
          class="w-full bg-green-700 hover:bg-green-800 font-bold py-2 px-4 rounded-lg transition duration-300 text-white"
        >
          Submit
        </button>
      </div>
    </div>

    <div
      id="instructionsModal"
      class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center"
    >
      <div class="bg-gray-800 rounded-lg p-4 max-w-md w-full">
        <h2 class="text-xl font-bold text-center text-white mb-3">
          How to Play
        </h2>
        <div class="carousel-container">
          <div class="carousel-item active">
            <h3 class="text-lg font-bold mb-2">1. Choose Letters</h3>
            <p>Select 1 vowel and 4 consonants</p>
          </div>
          <div class="carousel-item">
            <h3 class="text-lg font-bold mb-2">
              2. Try to guess the players name
            </h3>
            <p>
              Use your chosen letters to guess the Premier League player's name
            </p>
          </div>
          <div class="carousel-item">
            <h3 class="text-lg font-bold mb-2">3. Substitutions</h3>
            <p>
              If you do not know the players name then you can change letters up
              to 5 times throughout the game by clicking the "Make a sub"
              button. Vowels can only be substituted for vowels, and consonants
              for consonants
            </p>
          </div>
          <div class="carousel-item">
            <h3 class="text-lg font-bold mb-2">4. Rounds</h3>
            <p>
              There are 3 rounds in total. You have 45 seconds in round 1 and 2
              and then 30 seconds in round 3
            </p>
          </div>
          <div class="carousel-item">
            <h3 class="text-lg font-bold mb-2">5. Submit Your Guess</h3>
            <p>
              Click the "Guess Player" button to guess the players name. You
              only get 3 wrong guesses. The game is over and you get 0 points if
              you get sent off
            </p>
          </div>
          <div class="carousel-item">
            <h3 class="text-lg font-bold mb-2">6. Go to VAR</h3>
            <p>
              You can use the VAR button once per game to get a hint about the
              identity of the player
            </p>
          </div>
        </div>
        <div class="carousel-btn-container">
          <button id="prev-btn" class="carousel-btn">Previous</button>
          <button id="next-btn" class="carousel-btn">Next</button>
        </div>
        <button
          id="close-instructions"
          class="mt-4 w-full bg-gray-800 hover:bg-yellow-500 font-bold py-2 px-4 rounded-lg transition duration-300 text-white"
        >
          Got it!
        </button>
      </div>
    </div>

    <div
      id="varHintModal"
      class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center"
    >
      <div
        class="bg-gray-800 rounded-lg p-4 max-w-sm w-full border-solid border-gray-600 border-10 shadow-lg"
      >
        <h2 class="text-xl font-bold text-center mb-3">Checking...</h2>
        <div id="varHintText" class="text-lg text-center mb-3"></div>
        <button
          onclick="closeModal('varHintModal')"
          class="w-full bg-purple-600 hover:bg-purple-700 font-bold py-2 px-4 rounded-lg transition duration-300 text-white"
        >
          Check complete
        </button>
      </div>
    </div>

    <div
      id="guess-popup"
      class="fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-yellow-500 p-3 rounded-lg shadow-lg text-center hidden text-gray-900"
    ></div>

    <script>
      const VOWELS = ["A", "E", "I", "O", "U"];
      const SUBSTITUTION_COLORS = [
        "bg-red-600",
        "bg-yellow-600",
        "bg-purple-600",
        "bg-blue-600",
        "bg-green-600",
      ];

      class GameState {
        constructor() {
          this.chosenLetters = [];
          this.availableLetters = "ABCDEFGHIJKLMNOPQRSTUVWXYZ".split("");
          this.currentPlayer = "";
          this.displayedName = "";
          this.score = 0;
          this.substitutionsLeft = 5;
          this.timeLeft = 45;
          this.currentRound = 0;
          this.guessesLeft = 3;
          this.timerInterval = null;
          this.usedPlayers = [];
          this.usedLetters = new Set();
          this.pendingSubstitutions = {};
          this.allChosenLetters = new Set();
          this.varHintUsed = false;
          this.vowelCount = 0;
          this.substitutionColorMap = {};
          this.playerList = {
            modernPlayers: [
              {
                name: "ERLING HAALAND",
                hint: "Norwegian striker who broke the Premier League scoring record in his debut season",
              },
              {
                name: "KEVIN DE BRUYNE",
                hint: "Belgian midfielder known for his exceptional passing and vision",
              },
              {
                name: "MOHAMED SALAH",
                hint: "Egyptian forward who won the Premier League Golden Boot three times",
              },
              {
                name: "BRUNO FERNANDES",
                hint: "Portuguese midfielder who quickly became a key player for Manchester United",
              },
              {
                name: "MARCUS RASHFORD",
                hint: "English forward who came through Manchester United's academy",
              },
              {
                name: "JACK GREALISH",
                hint: "English midfielder with a record-breaking transfer fee to Manchester City",
              },
              {
                name: "BUKAYO SAKA",
                hint: "Young English winger who emerged from Arsenal's academy",
              },
              {
                name: "VIRGIL VAN DIJK",
                hint: "Dutch center-back considered one of the best defenders in the world",
              },
              {
                name: "TRENT ALEXANDER ARNOLD",
                hint: "Liverpool right-back known for his crossing and set-piece ability",
              },
              {
                name: "HEUNG MIN SON",
                hint: "South Korean forward who won the Premier League Golden Boot in 2021-22",
              },
              {
                name: "RAHEEM STERLING",
                hint: "English winger who has played for Liverpool, Manchester City, and Chelsea",
              },
              {
                name: "PHIL FODEN",
                hint: "Young English midfielder dubbed the 'Stockport Iniesta'",
              },
              {
                name: "GABRIEL JESUS",
                hint: "Brazilian forward who moved from Manchester City to Arsenal",
              },
              {
                name: "RUBEN DIAS",
                hint: "Portuguese defender who won the FWA Footballer of the Year in his debut Premier League season",
              },
              {
                name: "ANDREW ROBERTSON",
                hint: "Scottish left-back known for his consistent performances and assists",
              },
              {
                name: "THIAGO SILVA",
                hint: "Brazilian center-back who joined Chelsea late in his career",
              },
              {
                name: "MASON MOUNT",
                hint: "English midfielder who came through Chelsea's academy",
              },
              {
                name: "DECLAN RICE",
                hint: "English defensive midfielder who captained West Ham before a big move",
              },
              {
                name: "JAMES MADDISON",
                hint: "English attacking midfielder known for his creativity and set-pieces",
              },
              {
                name: "IVAN TONEY",
                hint: "English striker who had a remarkable rise from lower leagues to the Premier League",
              },
              {
                name: "CALLUM WILSON",
                hint: "English striker known for his goal-scoring ability when fit",
              },
              {
                name: "KIERAN TRIPPIER",
                hint: "English right-back who returned to the Premier League after a spell in Spain",
              },
              {
                name: "OLLIE WATKINS",
                hint: "English striker who made the jump from Championship to Premier League",
              },
              {
                name: "JAMES WARD PROWSE",
                hint: "English midfielder renowned for his exceptional free-kick ability",
              },
              {
                name: "GABRIEL MARTINELLI",
                hint: "Brazilian winger who joined Arsenal as a teenager",
              },
              {
                name: "MARTIN ODEGAARD",
                hint: "Norwegian midfielder who became Arsenal's youngest captain",
              },
              {
                name: "REECE JAMES",
                hint: "English right-back who emerged from Chelsea's academy",
              },
              {
                name: "RODRI",
                hint: "Spanish defensive midfielder who replaced Fernandinho at Manchester City",
              },
              {
                name: "BERNARDO SILVA",
                hint: "Portuguese midfielder known for his technical skills and work rate",
              },
              {
                name: "EDERSON",
                hint: "Brazilian goalkeeper known for his distribution skills",
              },
              {
                name: "ALISSON BECKER",
                hint: "Brazilian goalkeeper who scored a crucial header for Liverpool",
              },
              {
                name: "AARON RAMSDALE",
                hint: "English goalkeeper who became Arsenal's first choice after joining",
              },
              {
                name: "ANTHONY GORDON",
                hint: "English winger who moved from Everton to Newcastle for a large fee",
              },
              {
                name: "COLE PALMER",
                hint: "Young English midfielder who emerged from Manchester City's academy",
              },
              {
                name: "JOHN MCGINN",
                hint: "Scottish midfielder who helped Aston Villa return to the Premier League",
              },
              {
                name: "WILLIAM SALIBA",
                hint: "French defender who had to wait for his Arsenal debut",
              },
              {
                name: "DOMINIC SOLANKE",
                hint: "English striker who found his form after moving to Bournemouth",
              },
              {
                name: "ALEXANDER ISAK",
                hint: "Swedish striker who became Newcastle's record signing",
              },
              {
                name: "JARROD BOWEN",
                hint: "English winger who made the jump from Championship to Premier League",
              },
              {
                name: "JEAN-PHILIPPE MATETA",
                hint: "French striker who joined Crystal Palace from the Bundesliga",
              },
              {
                name: "PEDRO NETO",
                hint: "Portuguese winger who became a key player for Wolves",
              },
              {
                name: "JULIAN ALVAREZ",
                hint: "Argentine forward who won the World Cup before his first full Premier League season",
              },
              {
                name: "DARWIN NUNEZ",
                hint: "Uruguayan striker who joined Liverpool for a club-record fee",
              },
              {
                name: "RICHARLISON",
                hint: "Brazilian forward who played for Everton before joining Tottenham",
              },
              {
                name: "MOUSSA DIABY",
                hint: "French winger who joined Aston Villa from Bayer Leverkusen",
              },
              {
                name: "MICKY VAN DE VEN",
                hint: "Dutch defender who joined Tottenham and impressed with his speed",
              },
              {
                name: "MIGUEL ALMIRON",
                hint: "Paraguayan midfielder who became Newcastle's record signing",
              },
              {
                name: "DOUGLAS LUIZ",
                hint: "Brazilian midfielder who has been a consistent performer for Aston Villa",
              },
              {
                name: "MORGAN GIBBS-WHITE",
                hint: "English midfielder who made a big-money move to Nottingham Forest",
              },
              {
                name: "PASCAL GROSS",
                hint: "German midfielder who has been crucial for Brighton since their promotion",
              },
              {
                name: "BRENNAN JOHNSON",
                hint: "Welsh forward who helped Nottingham Forest return to the Premier League",
              },
            ],
            legendPlayers: [
              {
                name: "ALAN SHEARER",
                hint: "All-time top scorer in the Premier League",
              },
              {
                name: "THIERRY HENRY",
                hint: "French striker who was part of Arsenal's 'Invincibles'",
              },
              {
                name: "ERIC CANTONA",
                hint: "French forward known for his swagger and crucial role in Manchester United's success",
              },
              {
                name: "STEVEN GERRARD",
                hint: "Liverpool midfielder known for his long-range goals and leadership",
              },
              {
                name: "FRANK LAMPARD",
                hint: "Midfielder who became Chelsea's all-time top scorer",
              },
              {
                name: "RYAN GIGGS",
                hint: "Welsh winger who played for Manchester United for over two decades",
              },
              {
                name: "PATRICK VIEIRA",
                hint: "French midfielder who captained Arsenal during their 'Invincibles' season",
              },
              {
                name: "ROY KEANE",
                hint: "Irish midfielder known for his aggressive style and leadership at Manchester United",
              },
              {
                name: "PETER SCHMEICHEL",
                hint: "Danish goalkeeper who was crucial to Manchester United's success in the 90s",
              },
              {
                name: "JOHN TERRY",
                hint: "Chelsea defender who captained the club to multiple Premier League titles",
              },
              {
                name: "RIO FERDINAND",
                hint: "English defender who formed a formidable partnership with Nemanja Vidic",
              },
              {
                name: "PAUL SCHOLES",
                hint: "Manchester United midfielder known for his passing range and shooting ability",
              },
              {
                name: "WAYNE ROONEY",
                hint: "Forward who became Manchester United and England's all-time top scorer",
              },
              {
                name: "DIDIER DROGBA",
                hint: "Ivorian striker known for his physicality and crucial goals for Chelsea",
              },
              {
                name: "DENNIS BERGKAMP",
                hint: "Dutch forward renowned for his technical skill and creativity",
              },
              {
                name: "DAVID BECKHAM",
                hint: "English midfielder famous for his crossing and free-kick ability",
              },
              {
                name: "CRISTIANO RONALDO",
                hint: "Portuguese forward who won his first Ballon d'Or while at Manchester United",
              },
              {
                name: "VINCENT KOMPANY",
                hint: "Belgian defender who captained Manchester City to multiple titles",
              },
              {
                name: "ASHLEY COLE",
                hint: "English left-back considered one of the best in his position",
              },
              {
                name: "NEMANJA VIDIC",
                hint: "Serbian defender who formed a formidable partnership with Rio Ferdinand",
              },
              {
                name: "IAN WRIGHT",
                hint: "English striker who was Arsenal's top scorer before being surpassed by Thierry Henry",
              },
              {
                name: "JAMIE CARRAGHER",
                hint: "Liverpool defender who spent his entire career with the club",
              },
              {
                name: "GARY NEVILLE",
                hint: "Manchester United right-back who was part of the 'Class of 92'",
              },
              {
                name: "MICHAEL OWEN",
                hint: "English striker who won the Ballon d'Or while at Liverpool",
              },
              {
                name: "ROBBIE FOWLER",
                hint: "Liverpool striker nicknamed 'God' by the club's fans",
              },
              {
                name: "MATT LE TISSIER",
                hint: "Southampton midfielder known for his loyalty and spectacular goals",
              },
              {
                name: "GIANFRANCO ZOLA",
                hint: "Italian forward who became a Chelsea legend despite joining later in his career",
              },
              {
                name: "PAULO DI CANIO",
                hint: "Italian forward remembered for his spectacular goals and controversial moments",
              },
              {
                name: "RUUD VAN NISTELROOY",
                hint: "Dutch striker who was a prolific goalscorer for Manchester United",
              },
              {
                name: "EDWIN VAN DER SAR",
                hint: "Dutch goalkeeper who had a successful late career at Manchester United",
              },
              {
                name: "PETR CECH",
                hint: "Czech goalkeeper who holds the record for most clean sheets in the Premier League",
              },
              {
                name: "CLAUDE MAKELELE",
                hint: "French midfielder who defined the defensive midfield role",
              },
              {
                name: "ROBERT PIRES",
                hint: "French winger who was a key part of Arsenal's 'Invincibles'",
              },
              {
                name: "FREDDIE LJUNGBERG",
                hint: "Swedish midfielder who was part of Arsenal's 'Invincibles'",
              },
              {
                name: "SOL CAMPBELL",
                hint: "English defender who controversially moved from Tottenham to Arsenal",
              },
              {
                name: "ANDY COLE",
                hint: "English striker who is the third-highest goalscorer in Premier League history",
              },
              {
                name: "TEDDY SHERINGHAM",
                hint: "English forward who scored crucial goals for Manchester United in their treble-winning season",
              },
              {
                name: "LES FERDINAND",
                hint: "English striker nicknamed 'Sir Les' who played for several Premier League clubs",
              },
              {
                name: "TONY ADAMS",
                hint: "English defender who captained Arsenal to league titles in three different decades",
              },
            ],
            obscurePlayers: [
              {
                name: "STAN LAZARIDIS",
                hint: "Australian winger known for his time at Birmingham City",
              },
              {
                name: "ALI DIA",
                hint: "Senegalese forward who famously played one game for Southampton",
              },
              {
                name: "ERIC DJEMBA-DJEMBA",
                hint: "Cameroonian midfielder who played for Manchester United",
              },
              {
                name: "KIKI MUSAMPA",
                hint: "Dutch midfielder who had a short stint at Manchester City",
              },
              {
                name: "JAN VENNEGOOR OF HESSELINK",
                hint: "Dutch striker known for his long name and time at Hull City",
              },
              {
                name: "MARCELINO",
                hint: "Spanish defender who struggled with injuries at Newcastle United",
              },
              {
                name: "BOUDEWIJN ZENDEN",
                hint: "Dutch midfielder who played for Chelsea and Liverpool",
              },
              {
                name: "TOMASZ RADZINSKI",
                hint: "Canadian forward who played for Everton and Fulham",
              },
              {
                name: "NICKY SHOREY",
                hint: "English left-back who had a brief spell at Reading",
              },
              {
                name: "RICHARD KINGSON",
                hint: "Ghanaian goalkeeper who played for Wigan Athletic",
              },
              {
                name: "JULIANO BELLETTI",
                hint: "Brazilian defender who played for Chelsea",
              },
              {
                name: "CARLOS KAMENI",
                hint: "Cameroonian goalkeeper who had a brief stint in the Premier League",
              },
              {
                name: "ANTTI NIEMI",
                hint: "Finnish goalkeeper known for his time at Southampton",
              },
              {
                name: "DANIEL CARRICO",
                hint: "Portuguese defender who played for Reading",
              },
              {
                name: "GAVIN MCCANN",
                hint: "English midfielder who played for Aston Villa and Bolton",
              },
              {
                name: "NICKLAS BENDTNER",
                hint: "Danish forward known for his time at Arsenal",
              },
              {
                name: "ERIC NEVLAND",
                hint: "Norwegian forward who played for Fulham",
              },
              {
                name: "JOHN OSTER",
                hint: "Welsh winger who played for Everton and Reading",
              },
              {
                name: "MORITZ VOLZ",
                hint: "German defender who played for Fulham",
              },
              {
                name: "TAMAS PRISKIN",
                hint: "Hungarian forward who had a brief spell at Watford",
              },
              {
                name: "MARCUS HAHNEMANN",
                hint: "American goalkeeper who played for Reading",
              },
              {
                name: "PAUL KONCHESKY",
                hint: "English left-back who played for several Premier League clubs",
              },
              {
                name: "CHRIS BIRCHALL",
                hint: "Trinidadian midfielder who played for Coventry City",
              },
              {
                name: "SEBASTIEN BASSONG",
                hint: "Cameroonian defender who played for Newcastle and Tottenham",
              },
              {
                name: "HENRI CAMARA",
                hint: "Senegalese forward who played for Wigan Athletic",
              },
              {
                name: "SHAUN GOATER",
                hint: "Bermudian forward who played for Manchester City",
              },
              {
                name: "GEORGI KINKLADZE",
                hint: "Georgian midfielder known for his time at Manchester City",
              },
              {
                name: "GARETH FARRELLY",
                hint: "Irish midfielder who played for Everton and Bolton",
              },
              {
                name: "MATTHEW UPSON",
                hint: "English defender known for his time at Birmingham City",
              },
            ],
          };
        }

        reset() {
          this.chosenLetters = [];
          this.score = 0;
          this.substitutionsLeft = 5;
          this.currentRound = 0;
          this.guessesLeft = 3;
          this.usedPlayers = [];
          this.usedLetters.clear();
          this.pendingSubstitutions = {};
          this.allChosenLetters.clear();
          this.timeLeft = 45;
          this.currentPlayer = "";
          this.displayedName = "";
          this.varHintUsed = false;
          this.vowelCount = 0;
          clearInterval(this.timerInterval);
        }
      }

      const gameState = new GameState();

      // DOM elements
      const letterGrid = document.getElementById("letter-grid");
      const playerNameEl = document.getElementById("player-name");
      const timerEl = document.getElementById("timer");
      const timerBar = document.getElementById("timer-bar");
      const scoreEl = document.getElementById("score");
      const substitutionsEl = document.getElementById("substitutions");
      const guessesLeftEl = document.getElementById("guesses-left");
      const solveBtn = document.getElementById("solve");
      const substituteBtn = document.getElementById("substitute");
      const newGameBtn = document.getElementById("new-game");
      const roundInfoEl = document.getElementById("round-info");
      const currentTeamEl = document.getElementById("current-team");
      const startingLineupEl = document.getElementById("starting-lineup");
      const varButton = document.getElementById("varButton");

      const substituteModal = document.getElementById("substituteModal");
      const solveModal = document.getElementById("solveModal");
      const substituteGrid = document.getElementById("substitute-grid");
      const solveInput = document.getElementById("solve-input");
      const submitSolveBtn = document.getElementById("submit-solve");
      const solveTimerEl = document.getElementById("solve-timer");
      const currentPlayerEl = document.getElementById("current-player");

      const howToPlayBtn = document.getElementById("how-to-play-btn");
      const instructionsModal = document.getElementById("instructionsModal");
      const carouselItems = document.querySelectorAll(".carousel-item");
      let currentSlide = 0;

      function showSlide(index) {
        carouselItems.forEach((item, i) => {
          item.classList.toggle("active", i === index);
        });
      }

      document.getElementById("next-btn").addEventListener("click", () => {
        currentSlide = (currentSlide + 1) % carouselItems.length;
        showSlide(currentSlide);
      });

      document.getElementById("prev-btn").addEventListener("click", () => {
        currentSlide =
          (currentSlide - 1 + carouselItems.length) % carouselItems.length;
        showSlide(currentSlide);
      });

      // Game functions
      function toggleGameControls(show) {
        const gameControls = document.getElementById("game-controls");
        if (show) {
          gameControls.classList.remove("hidden");
          gameControls.classList.add("flex");
        } else {
          gameControls.classList.add("hidden");
          gameControls.classList.remove("flex");
        }
      }

      function startGame() {
        gameState.reset();
        updateScore();
        updateSubstitutions();
        updateGuessesLeft();
        resetTimerDisplay();
        updateRoundInfo();
        playerNameEl.textContent = "";
        currentTeamEl.classList.add("hidden");
        startingLineupEl.classList.add("hidden");
        document.getElementById("player-card").classList.add("hidden");
        document.getElementById("game-info-section").classList.add("hidden");
        toggleGameControls(false);
        document.getElementById("start-game").classList.add("hidden");
        newGameBtn.classList.add("hidden");
        varButton.disabled = false;

        letterGrid.innerHTML = "";
        letterGrid.classList.remove("hidden");

        const vowelContainer = document.createElement("div");
        vowelContainer.id = "vowel-container";
        vowelContainer.classList.add("mb-4", "p-2", "rounded-lg");
        vowelContainer.innerHTML =
          "<p class='text-center mb-2 text-white font-bold'>Select 1 vowel</p><div class='grid grid-cols-5 gap-2'></div>";

        const consonantContainer = document.createElement("div");
        consonantContainer.id = "consonant-container";
        consonantContainer.innerHTML =
          "<p class='text-center mb-2 text-white font-bold'>Select 4 consonants</p><div class='grid grid-cols-4 gap-2'></div>";

        letterGrid.appendChild(vowelContainer);
        letterGrid.appendChild(consonantContainer);

        selectInitialLetters();

        substituteGrid.innerHTML = "";
        solveInput.value = "";

        adjustLayoutForScreenSize();
      }

      function resetTimerDisplay() {
        timerEl.textContent = `Time: ${gameState.timeLeft}s`;
        timerBar.style.width = "100%";
        timerBar.classList.remove("pulse");
      }

      function selectInitialLetters() {
        const vowelGrid = document.querySelector("#vowel-container .grid");
        const consonantGrid = document.querySelector(
          "#consonant-container .grid"
        );
        vowelGrid.innerHTML = "";
        consonantGrid.innerHTML = "";

        gameState.availableLetters.forEach((letter) => {
          const button = document.createElement("button");
          button.textContent = letter;
          button.classList.add(
            "letter-btn",
            "bg-blue-600",
            "hover:bg-blue-500",
            "text-white",
            "font-bold",
            "py-2",
            "px-4",
            "rounded-lg",
            "transition",
            "duration-300",
            "text-lg",
            "sm:text-xl"
          );
          button.addEventListener("click", () => toggleLetter(letter, button));

          if (VOWELS.includes(letter)) {
            vowelGrid.appendChild(button);
          } else {
            consonantGrid.appendChild(button);
          }
        });

        updateStartingLineup();

        gameState.chosenLetters = [];
        gameState.allChosenLetters.clear();
        gameState.vowelCount = 0;
      }

      function toggleLetter(letter, button) {
        const index = gameState.chosenLetters.indexOf(letter);
        const isVowel = VOWELS.includes(letter);

        if (index === -1 && gameState.chosenLetters.length < 5) {
          if (isVowel && gameState.vowelCount >= 1) {
            showMessage("You can only select one vowel!");
            return;
          }
          if (
            !isVowel &&
            gameState.chosenLetters.length - gameState.vowelCount >= 4
          ) {
            showMessage("You can only select four consonants!");
            return;
          }
          gameState.chosenLetters.push(letter);
          button.classList.remove("bg-blue-600", "hover:bg-blue-500");
          button.classList.add("bg-green-700", "hover:bg-green-800");
          if (isVowel) gameState.vowelCount++;
        } else if (index !== -1) {
          gameState.chosenLetters.splice(index, 1);
          button.classList.remove("bg-green-700", "hover:bg-green-800");
          button.classList.add("bg-blue-600", "hover:bg-blue-500");
          if (isVowel) gameState.vowelCount--;
        }
        updateStartingLineup();
        if (gameState.chosenLetters.length === 5) {
          document.getElementById("start-game").classList.remove("hidden");
        } else {
          document.getElementById("start-game").classList.add("hidden");
        }
      }

      function updateStartingLineup() {
        startingLineupEl.textContent = `Your starting lineup: ${gameState.chosenLetters.join(
          ", "
        )}`;
        startingLineupEl.classList.remove("hidden");
      }

      function updateCurrentTeam() {
        currentTeamEl.textContent = `Your current team: ${gameState.chosenLetters.join(
          ", "
        )}`;
      }

      function startRound() {
        gameState.currentRound++;
        const availablePlayers =
          gameState.currentRound === 1
            ? gameState.playerList.modernPlayers
            : gameState.currentRound === 2
            ? gameState.playerList.legendPlayers
            : gameState.playerList.obscurePlayers;

        do {
          gameState.currentPlayer =
            availablePlayers[
              Math.floor(Math.random() * availablePlayers.length)
            ];
        } while (gameState.usedPlayers.includes(gameState.currentPlayer.name));

        gameState.usedPlayers.push(gameState.currentPlayer.name);

        playerNameEl.classList.add("fade-out");
        setTimeout(() => {
          updateDisplayedName();
          playerNameEl.classList.remove("fade-out");
          playerNameEl.classList.add("fade-in");
        }, 500);

        roundInfoEl.classList.add("slide-in");

        gameState.timeLeft = gameState.currentRound === 3 ? 30 : 45;
        startTimer();
        updateRoundInfo();
        updateGuessesLeft();

        letterGrid.classList.add("hidden");
        startingLineupEl.classList.add("hidden");
        currentTeamEl.classList.remove("hidden");
        document.getElementById("player-card").classList.remove("hidden");
        document.getElementById("game-info-section").classList.remove("hidden");
        document.getElementById("start-game").classList.add("hidden");
        toggleGameControls(true);

        gameState.allChosenLetters.clear();
        gameState.chosenLetters.forEach((letter) =>
          gameState.allChosenLetters.add(letter.toUpperCase())
        );

        updateCurrentTeam();
        showGameInfoSection();
      }

      function updateRoundInfo() {
        if (gameState.currentRound === 0) {
          roundInfoEl.textContent =
            "Choose 5 letters to form your starting lineup!";
        } else {
          let roundMessage;
          switch (gameState.currentRound) {
            case 1:
              roundMessage = "Guess the current Premier League player!";
              break;
            case 2:
              roundMessage = "Guess the Premier League legend!";
              break;
            case 3:
              roundMessage = "Guess the forgotten Premier League star!";
              break;
          }
          roundInfoEl.textContent = `Round ${gameState.currentRound}: ${roundMessage}`;
        }
      }

      function updateDisplayedName() {
        const newDisplayedName = gameState.currentPlayer.name
          .split("")
          .map((char) =>
            char === " "
              ? " "
              : gameState.allChosenLetters.has(char.toUpperCase())
              ? `<span class="letter-reveal">${char}</span>`
              : "_"
          )
          .join("");

        if (playerNameEl.innerHTML !== newDisplayedName) {
          playerNameEl.innerHTML = newDisplayedName;
          playerNameEl
            .querySelectorAll(".letter-reveal")
            .forEach((span, index) => {
              span.style.transitionDelay = `${index * 100}ms`;
              setTimeout(() => (span.style.color = "white"), 50);
            });
        }
      }

      function startTimer() {
        clearInterval(gameState.timerInterval);
        const totalTime = gameState.currentRound === 3 ? 30 : 45;
        gameState.timerInterval = setInterval(() => {
          gameState.timeLeft--;
          updateTimerDisplay();
          if (gameState.timeLeft === 0) {
            clearInterval(gameState.timerInterval);
            roundInfoEl.textContent = `Time's up! Moving to next round...`;
            setTimeout(endRound, 3000);
          }
        }, 1000);
      }

      function updateTimerDisplay() {
        timerEl.textContent = `Time: ${gameState.timeLeft}s`;
        const totalTime = gameState.currentRound === 3 ? 30 : 45;
        const percentage = (gameState.timeLeft / totalTime) * 100;
        timerBar.style.width = `${percentage}%`;
        if (gameState.timeLeft <= 10) {
          timerBar.classList.add("pulse");
        } else {
          timerBar.classList.remove("pulse");
        }
      }

      function substituteLetters() {
        if (gameState.substitutionsLeft > 0) {
          pauseTimer();
          gameState.pendingSubstitutions = {};
          showSubstituteOptions();
          openModal("substituteModal");
          updateCurrentPlayerDisplay();
        } else {
          showMessage("No substitutions left!");
        }
      }

      function pauseTimer() {
        clearInterval(gameState.timerInterval);
      }

      function resumeTimer() {
        startTimer();
      }

      function showSubstituteOptions() {
        substituteGrid.innerHTML = `
          <div class="mb-4">
            <h3 class="text-xl font-bold mb-2">Select letters to substitute</h3>
            <div id="current-letters-grid" class="grid grid-cols-5 gap-2 mb-4"></div>
            <div id="available-letters-grid" class="grid grid-cols-5 gap-2"></div>
          </div>
          <button id="confirm-substitution" class="w-full bg-yellow-600 hover:bg-yellow-700 text-white font-bold py-2 px-4 rounded transition duration-300">
            Make substitutions
          </button>
        `;

        const currentLettersGrid = document.getElementById(
          "current-letters-grid"
        );
        const availableLettersGrid = document.getElementById(
          "available-letters-grid"
        );
        const confirmSubstitutionBtn = document.getElementById(
          "confirm-substitution"
        );

        gameState.chosenLetters.forEach((letter, index) => {
          const button = createLetterButton(letter, "current", index);
          currentLettersGrid.appendChild(button);
        });

        gameState.availableLetters.forEach((letter) => {
          if (
            !gameState.chosenLetters.includes(letter) &&
            !gameState.usedLetters.has(letter)
          ) {
            const button = createLetterButton(letter, "available");
            availableLettersGrid.appendChild(button);
          }
        });

        confirmSubstitutionBtn.addEventListener("click", confirmSubstitution);
        updateAvailableLetters();
      }

      function createLetterButton(letter, type, index) {
        const button = document.createElement("button");
        button.textContent = letter;
        button.classList.add(
          "letter-btn",
          "text-white",
          "font-bold",
          "py-4",
          "px-6",
          "rounded-lg",
          "text-2xl",
          "transition",
          "duration-300"
        );

        if (type === "current") {
          const color = SUBSTITUTION_COLORS[index % SUBSTITUTION_COLORS.length];
          gameState.substitutionColorMap[letter] = color;
          button.classList.add(color, `hover:${color.replace("600", "700")}`);
          button.addEventListener("click", () =>
            toggleCurrentLetter(letter, button)
          );
        } else {
          button.classList.add(
            "bg-gray-600",
            "opacity-50",
            "cursor-not-allowed"
          );
          button.addEventListener("click", () =>
            toggleAvailableLetter(letter, button)
          );
        }

        return button;
      }

      function toggleCurrentLetter(letter, button) {
        if (gameState.pendingSubstitutions[letter]) {
          const color = gameState.substitutionColorMap[letter];
          delete gameState.pendingSubstitutions[letter];
          button.classList.remove(
            color,
            `hover:${color.replace("600", "700")}`
          );
          button.classList.add(color, "hover:bg-blue-500");
        } else {
          const color = gameState.substitutionColorMap[letter];
          gameState.pendingSubstitutions[letter] = null;
          button.classList.remove("bg-blue-600", "hover:bg-blue-700");
          button.classList.add(color, `hover:${color.replace("600", "700")}`);
        }
        updateAvailableLetters();
      }

      function toggleAvailableLetter(letter, button) {
        const isVowel = VOWELS.includes(letter);
        const correspondingCurrentLetter = Object.keys(
          gameState.pendingSubstitutions
        ).find(
          (key) =>
            gameState.pendingSubstitutions[key] === null &&
            VOWELS.includes(key) === isVowel
        );

        if (correspondingCurrentLetter) {
          const color =
            gameState.substitutionColorMap[correspondingCurrentLetter];
          if (
            gameState.pendingSubstitutions[correspondingCurrentLetter] ===
            letter
          ) {
            // Deselect this letter
            gameState.pendingSubstitutions[correspondingCurrentLetter] = null;
            button.classList.remove(
              color,
              `hover:${color.replace("600", "700")}`
            );
            button.classList.add(
              "bg-gray-600",
              "opacity-50",
              "cursor-not-allowed"
            );
          } else {
            // Select this letter
            gameState.pendingSubstitutions[correspondingCurrentLetter] = letter;
            button.classList.remove(
              "bg-gray-600",
              "opacity-50",
              "cursor-not-allowed"
            );
            button.classList.add(color, `hover:${color.replace("600", "700")}`);
          }
        }
        updateAvailableLetters();
      }

      function updateAvailableLetters() {
        const availableButtons = document.querySelectorAll(
          "#available-letters-grid .letter-btn"
        );
        const pendingVowels = Object.keys(
          gameState.pendingSubstitutions
        ).filter(
          (letter) =>
            VOWELS.includes(letter) &&
            gameState.pendingSubstitutions[letter] === null
        ).length;
        const pendingConsonants = Object.keys(
          gameState.pendingSubstitutions
        ).filter(
          (letter) =>
            !VOWELS.includes(letter) &&
            gameState.pendingSubstitutions[letter] === null
        ).length;

        availableButtons.forEach((btn) => {
          const letter = btn.textContent;
          const isSelected = Object.values(
            gameState.pendingSubstitutions
          ).includes(letter);
          const correspondingCurrentLetter = Object.keys(
            gameState.pendingSubstitutions
          ).find((key) => gameState.pendingSubstitutions[key] === letter);

          btn.classList.remove(
            ...SUBSTITUTION_COLORS,
            ...SUBSTITUTION_COLORS.map(
              (color) => `hover:${color.replace("600", "700")}`
            )
          );

          if (isSelected) {
            const color =
              gameState.substitutionColorMap[correspondingCurrentLetter];
            btn.classList.remove(
              "bg-gray-600",
              "opacity-50",
              "cursor-not-allowed"
            );
            btn.classList.add(color, `hover:${color.replace("600", "700")}`);
          } else if (
            (VOWELS.includes(letter) && pendingVowels > 0) ||
            (!VOWELS.includes(letter) && pendingConsonants > 0)
          ) {
            btn.classList.remove(
              "bg-gray-600",
              "opacity-50",
              "cursor-not-allowed"
            );
            btn.classList.add(
              "bg-green-600",
              "hover:bg-green-700",
              "cursor-pointer"
            );
          } else {
            btn.classList.remove(
              "bg-green-600",
              "hover:bg-green-700",
              "cursor-pointer"
            );
            btn.classList.add(
              "bg-gray-600",
              "opacity-50",
              "cursor-not-allowed"
            );
          }
        });
      }

      function confirmSubstitution() {
        const substitutions = Object.entries(
          gameState.pendingSubstitutions
        ).filter(([_, newLetter]) => newLetter !== null);

        if (
          substitutions.length > 0 &&
          substitutions.length <= gameState.substitutionsLeft
        ) {
          substitutions.forEach(([oldLetter, newLetter]) => {
            const index = gameState.chosenLetters.indexOf(oldLetter);
            gameState.chosenLetters[index] = newLetter;
            gameState.usedLetters.add(oldLetter);
            gameState.usedLetters.add(newLetter);
            gameState.allChosenLetters.add(newLetter.toUpperCase());
          });

          gameState.substitutionsLeft -= substitutions.length;
          updateSubstitutions();
          updateCurrentTeam();
          updateDisplayedName();
          closeModal("substituteModal");
          resumeTimer();
          showSubstitutionFeedback(
            substitutions.map(([oldLetter]) => oldLetter),
            substitutions.map(([, newLetter]) => newLetter)
          );
        } else if (gameState.substitutionsLeft <= 0) {
          showMessage("No substitutions left!");
        } else {
          showMessage("Please select new letters to substitute!");
        }
      }

      function showSubstitutionFeedback(oldLetters, newLetters) {
        const feedbackEl = document.createElement("div");
        feedbackEl.classList.add(
          "text-center",
          "text-white",
          "my-4",
          "p-2",
          "bg-blue-600",
          "rounded"
        );
        feedbackEl.innerHTML = `Substituted: ${oldLetters.join(
          ", "
        )} ➡️ ${newLetters.join(", ")}`;
        document
          .getElementById("game-container")
          .insertBefore(feedbackEl, roundInfoEl);
        setTimeout(() => feedbackEl.remove(), 3000);
      }

      function updateCurrentPlayerDisplay() {
        currentPlayerEl.textContent = gameState.currentPlayer.name
          .split("")
          .map((char) =>
            char === " "
              ? " "
              : gameState.allChosenLetters.has(char.toUpperCase())
              ? char
              : "_"
          )
          .join("");
      }

      let solveModalTimer;
      function openSolveModal() {
        openModal("solveModal");
        let timeLeft = 10;
        updateSolveModalTimer(timeLeft);
        solveModalTimer = setInterval(() => {
          timeLeft--;
          updateSolveModalTimer(timeLeft);
          if (timeLeft <= 0) {
            clearInterval(solveModalTimer);
            attemptSolve();
          }
        }, 1000);
      }

      function updateSolveModalTimer(time) {
        solveTimerEl.textContent = `Time left: ${time}s`;
      }

      function attemptSolve() {
        clearInterval(solveModalTimer);
        const guess = solveInput.value
          .toUpperCase()
          .replace(/\s+/g, " ")
          .trim();
        if (guess === gameState.currentPlayer.name) {
          gameState.score += gameState.currentRound === 3 ? 3 : 1;
          updateScore();
          showSuccessMessage("Correct! Well done!");
          endRound();
        } else {
          gameState.guessesLeft--;
          updateGuessesLeft();
          showIncorrectGuessPopup(guess);
          if (gameState.guessesLeft === 0) {
            setTimeout(() => {
              endGame();
            }, 2000);
          }
        }
        solveInput.value = "";
        closeModal("solveModal");
      }

      function showIncorrectGuessPopup(guess) {
        const popup = document.getElementById("guess-popup");
        let message;
        switch (gameState.guessesLeft) {
          case 2:
            message = "The ref wants the game to flow so that's just a warning";
            break;
          case 1:
            message = "Oooooo, that's a booking!";
            break;
          case 0:
            message = "That's a shocking tackle! Get off the pitch!";
            break;
          default:
            message = "Incorrect guess!";
        }
        popup.textContent = `${message} Your guess: ${guess}`;
        popup.classList.remove("hidden");
        popup.classList.add("fade-in");
        setTimeout(() => {
          popup.classList.remove("fade-in");
          popup.classList.add("fade-out");
          setTimeout(() => {
            popup.classList.add("hidden");
            popup.classList.remove("fade-out");
          }, 500);
        }, 2000);
      }

      function showSuccessMessage(message) {
        const popup = document.getElementById("guess-popup");
        popup.textContent = message;
        popup.classList.remove("hidden", "bg-yellow-600");
        popup.classList.add("bg-green-700", "fade-in");
        setTimeout(() => {
          popup.classList.remove("fade-in");
          popup.classList.add("fade-out");
          setTimeout(() => {
            popup.classList.add("hidden");
            popup.classList.remove("fade-out", "bg-green-700");
            popup.classList.add("bg-yellow-600");
          }, 500);
        }, 2000);
      }

      function endRound() {
        clearInterval(gameState.timerInterval);
        playerNameEl.classList.add("fade-out");
        setTimeout(() => {
          if (gameState.currentRound < 3) {
            showRoundTransition();
          } else {
            endGame();
          }
        }, 500);
      }

      function showRoundTransition() {
        const transitionEl = document.createElement("div");
        transitionEl.classList.add(
          "fixed",
          "inset-0",
          "bg-black",
          "bg-opacity-75",
          "flex",
          "items-center",
          "justify-center",
          "text-white",
          "text-4xl",
          "font-bold"
        );
        transitionEl.innerHTML = `
          <div class="text-center">
            <p>Round ${gameState.currentRound} completed!</p>
            <p class="mt-4">Current Score: ${gameState.score}</p>
            <p class="mt-8">Preparing Round ${gameState.currentRound + 1}...</p>
          </div>
        `;
        document.body.appendChild(transitionEl);
        setTimeout(() => {
          document.body.removeChild(transitionEl);
          startRound();
        }, 3000);
      }

      function endGame() {
        clearInterval(gameState.timerInterval);
        roundInfoEl.textContent = `Game over! Final score: ${gameState.score}`;
        toggleGameControls(false);
        newGameBtn.classList.remove("hidden");
        playerNameEl.textContent = "";
        timerEl.textContent = "Time: 0s";
        timerBar.style.width = "0%";
        currentTeamEl.classList.add("hidden");
      }

      function updateScore() {
        scoreEl.textContent = `Score: ${gameState.score}`;
      }

      function updateSubstitutions() {
        substitutionsEl.textContent = `Subs: ${gameState.substitutionsLeft}`;
        substituteBtn.disabled = gameState.substitutionsLeft <= 0;
      }

      function updateGuessesLeft() {
        guessesLeftEl.textContent = `Guesses: ${gameState.guessesLeft}`;
      }

      function openModal(modalId) {
        document.getElementById(modalId).classList.remove("hidden");
        document.getElementById(modalId).classList.add("flex");
        document
          .getElementById("game-container")
          .classList.add("blur-background");
        if (modalId === "solveModal") {
          pauseTimer();
          openSolveModal();
        } else if (modalId === "substituteModal") {
          pauseTimer();
        }
      }

      function closeModal(modalId) {
        document.getElementById(modalId).classList.add("hidden");
        document.getElementById(modalId).classList.remove("flex");
        document
          .getElementById("game-container")
          .classList.remove("blur-background");
        if (modalId === "solveModal") {
          clearInterval(solveModalTimer);
          resumeTimer();
        } else if (
          modalId === "substituteModal" ||
          modalId === "varHintModal"
        ) {
          resumeTimer();
        }
      }

      function adjustLayoutForScreenSize() {
        const gameContainer = document.getElementById("game-container");
        const howToPlayBtn = document.getElementById("how-to-play-btn");
        const letterGrid = document.getElementById("letter-grid");
        if (window.innerWidth < 640) {
          gameContainer.classList.remove("max-w-4xl");
          gameContainer.classList.add("max-w-full");
          howToPlayBtn.classList.add("w-full");
          howToPlayBtn.classList.remove("absolute", "top-2", "right-2");
          letterGrid.classList.add("grid-cols-4");
          letterGrid.classList.remove("grid-cols-5");
        } else {
          gameContainer.classList.remove("max-w-full");
          gameContainer.classList.add("max-w-4xl");
          howToPlayBtn.classList.remove("w-full");
          howToPlayBtn.classList.add("absolute", "top-2", "right-2");
          letterGrid.classList.remove("grid-cols-4");
          letterGrid.classList.add("grid-cols-5");
        }
      }

      function showGameInfoSection() {
        const gameInfoSection = document.getElementById("game-info-section");
        gameInfoSection.classList.remove("hidden");
      }

      function showVARHint() {
        if (!gameState.varHintUsed) {
          gameState.varHintUsed = true;
          const hintModal = document.getElementById("varHintModal");
          const hintText = document.getElementById("varHintText");
          hintText.textContent = gameState.currentPlayer.hint;
          openModal("varHintModal");
          varButton.disabled = true;
          pauseTimer(); // Pause the timer during VAR check
        }
      }

      function showMessage(message) {
        roundInfoEl.textContent = message;
        setTimeout(() => updateRoundInfo(), 2000);
      }

      // Event listeners
      solveBtn.addEventListener("click", () => openModal("solveModal"));
      substituteBtn.addEventListener("click", substituteLetters);
      submitSolveBtn.addEventListener("click", attemptSolve);
      newGameBtn.addEventListener("click", startGame);
      document
        .getElementById("start-game")
        .addEventListener("click", startRound);
      howToPlayBtn.addEventListener("click", () =>
        openModal("instructionsModal")
      );
      document
        .getElementById("close-instructions")
        .addEventListener("click", () => closeModal("instructionsModal"));
      varButton.addEventListener("click", showVARHint);

      // Add click event listeners to close modals when clicking outside
      document.querySelectorAll(".fixed.inset-0").forEach((modal) => {
        modal.addEventListener("click", function (event) {
          if (event.target === this) {
            closeModal(this.id);
          }
        });
      });

      solveInput.addEventListener("keypress", function (e) {
        if (e.key === "Enter") {
          e.preventDefault();
          attemptSolve();
        }
      });

      window.addEventListener("resize", adjustLayoutForScreenSize);

      // Initialize the game
      startGame();
      adjustLayoutForScreenSize();
    </script>
  </body>
</html>
